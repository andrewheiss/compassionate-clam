{
  "hash": "e8fb80a9412a409a3b25a1f2809fcc3f",
  "result": {
    "markdown": "---\ntitle: \"Registration timing\"\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(brms)\nlibrary(marginaleffects)\nlibrary(tidybayes)\nlibrary(ggdist)\nlibrary(patchwork)\nlibrary(scales)\n\n# Generated via random.org\nset.seed(196491)\n\n# Load targets\ntar_load(ongo)\ntar_load(c(m_full_ordbeta, preds_timing))\ninvisible(list2env(tar_read(graphic_functions), .GlobalEnv))\n\nprop_to_provinces <- function(x, lower = 1, upper = 32) {\n  (x * (upper - lower)) + lower\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nepreds <- m_full_ordbeta |> \n  epred_draws(datagrid(model = m_full_ordbeta, years_since_law = 0:5), \n              ndraws = 1000)\n\nepreds |> \n  mutate(years_since_law = factor(years_since_law)) |> \n  ggplot(aes(x = .epred, y = years_since_law)) +\n  stat_halfeye(fill = clrs[7]) +\n  scale_x_continuous(labels = label_percent(),\n                     sec.axis = sec_axis(trans = ~ prop_to_provinces(.),\n                                         name = \"Expected provinces\",\n                                         breaks = seq(8, 32, 4))) +\n  guides(fill = \"none\") +\n  labs(x = \"Expected proportion of provinces\", y = \"Years since law took effect in 2017\") +\n  theme_ongo() +\n  theme(axis.ticks.x.top = element_line(linewidth = 0.25, color = \"grey50\"))\n```\n\n::: {.cell-output-display}\n![](analysis-timing_files/figure-html/plot-epred-timing-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nepreds |> \n  ggplot(aes(x = years_since_law, y = .epred)) +\n  scale_x_reverse() +\n  scale_y_continuous(labels = label_percent(),\n                     sec.axis = sec_axis(trans = ~ prop_to_provinces(.),\n                                         name = \"Expected provinces\")) +\n  labs(x = \"Years since law took effect (2017)\", \n       y = \"Expected proportion of provinces\") +\n  stat_lineribbon(alpha = 0.35, fill = clrs[7], color = clrs[7]) +\n  theme_ongo() +\n  theme(axis.title.y.right = element_text(hjust = 1, margin = margin(l = 10), angle = 90))\n```\n\n::: {.cell-output-display}\n![](analysis-timing_files/figure-html/plot-epred-timing-lineribbon-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npreds_timing_plot <- preds_timing |> \n  unnest(preds) |> \n  mutate(outcome = case_when(\n    .prediction == 0 ~ \"1 province\",\n    .prediction > 0 & .prediction < 1 ~ \"1â€“32 provinces\",\n    .prediction == 1 ~ \"32 provinces\"\n  )) |> \n  group_by(outcome, years_since_law, draw) |>\n  summarize(count = n()) |> \n  group_by(years_since_law) |> \n  mutate(prop = count / sum(count) * 100)\n\nggplot(preds_timing_plot, aes(x = years_since_law, y = prop)) +\n  stat_lineribbon(alpha = 0.35, fill = clrs[7], color = clrs[7]) +\n  expand_limits(y = 0) +\n  facet_wrap(vars(outcome)) +\n  scale_x_reverse(breaks = c(0:5)) +\n  scale_y_continuous(labels = label_percent()) +\n  labs(x = \"Years since law took effect (2017)\", \n       y = \"Proportion of predictions\") +\n  theme_ongo()\n```\n\n::: {.cell-output-display}\n![](analysis-timing_files/figure-html/plot-pred-discrete-continuous-timing-1.png){fig-align='center' width=80%}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}