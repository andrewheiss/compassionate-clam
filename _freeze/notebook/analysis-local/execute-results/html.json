{
  "hash": "25f4f1287f360abd6369a2f71a8ee53c",
  "result": {
    "markdown": "---\ntitle: \"Local connections\"\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(brms)\nlibrary(marginaleffects)\nlibrary(tidybayes)\nlibrary(ggdist)\nlibrary(patchwork)\nlibrary(scales)\n\n# Generated via random.org\nset.seed(196491)\n\n# Load targets\ntar_load(ongo)\ntar_load(m_full_ordbeta)\ninvisible(list2env(tar_read(graphic_functions), .GlobalEnv))\n\nprop_to_provinces <- function(x, lower = 1, upper = 32) {\n  (x * (upper - lower)) + lower\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npreds <- m_full_ordbeta |> \n  predicted_draws(datagrid(model = m_full_ordbeta, local_connect = unique), \n                  ndraws = 1000)\n\n\nepreds <- m_full_ordbeta |> \n  epred_draws(datagrid(model = m_full_ordbeta, local_connect = unique), \n              ndraws = 1000)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nepreds |> \n  ungroup() |> \n  mutate(local_connect = factor(local_connect, labels = c(\"No local connections\", \"Local connections\"))) |> \n  ggplot(aes(x = .epred, y = local_connect)) +\n  stat_halfeye(fill = clrs[2]) +\n  scale_x_continuous(labels = label_percent(),\n                     sec.axis = sec_axis(trans = ~ prop_to_provinces(.),\n                                         name = \"Expected provinces\",\n                                         breaks = seq(8, 32, 4))) +\n  guides(fill = \"none\") +\n  labs(x = \"Expected proportion of provinces\", y = NULL) +\n  theme_ongo() +\n  theme(axis.ticks.x.top = element_line(linewidth = 0.25, color = \"grey50\"))\n```\n\n::: {.cell-output-display}\n![](analysis-local_files/figure-html/plot-epred-local-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npreds_local_plot <- preds %>% \n  ungroup() %>% \n  mutate(local_connect = factor(local_connect, labels = c(\"No local connections\", \"Local connections\"))) |> \n  mutate(outcome = case_when(\n    .prediction == 0 ~ \"1 province\",\n    .prediction > 0 & .prediction < 1 ~ \"1â€“32 provinces\",\n    .prediction == 1 ~ \"32 provinces\"\n  )) %>% \n  group_by(outcome, local_connect) %>% \n  summarize(count = n()) |> \n  group_by(local_connect) |> \n  mutate(prop = count / sum(count))\n\nggplot(preds_local_plot, aes(x = local_connect, y = prop)) +\n  geom_segment(aes(xend = local_connect, yend = 0), color = \"grey50\") +\n  geom_point(color = clrs[2], size = 2) +\n  expand_limits(y = 0) +\n  facet_wrap(vars(outcome)) +\n  scale_x_discrete(labels = label_wrap(10)) +\n  scale_y_continuous(labels = label_percent()) +\n  labs(x = NULL, y = \"Proportion of predictions\") +\n  theme_ongo()\n```\n\n::: {.cell-output-display}\n![](analysis-local_files/figure-html/plot-pred-discrete-continuous-local-1.png){fig-align='center' width=80%}\n:::\n:::\n",
    "supporting": [
      "analysis-local_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}