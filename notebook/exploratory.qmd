---
title: EDA
---


```{r load-packages-data, message=FALSE, warning=FALSE}
library(tidyverse)
library(targets)
library(here)
library(sf)
library(ggrepel)

# Point to the _targets folder location since this qmd is in a subfolder
tar_config_set(store = here::here('_targets'),
               script = here::here('_targets.R'))

# Load targets
tar_load(ongo)
mapdata <- tar_read(ongo_mapdata)
invisible(list2env(tar_read(graphic_functions), .GlobalEnv))
set_annotation_fonts()
```

# Timeline of registration

TODO


# Distribution of outcome

```{r province-count-distribution, warning=FALSE}
ggplot(ongo, aes(x = province_count)) +
  geom_histogram(binwidth = 1, color = "white", size = 0.1, boundary = 0) +
  labs(x = "Number of provinces", y = "Count",
       title = "Distribution of province counts") +
  theme_ongo()
```


# Map of provinces and counts

```{r ongo-map, fig.height=5, fig.width=7, message=FALSE, warning=FALSE}
# Use aes(geometry) and stat = "sf_coordinates" to make geom_label_repel() work
# with geom_sf(): https://github.com/slowkow/ggrepel/issues/111#issuecomment-416853013
labeldata <- mapdata |> 
  filter(ro_count > 0)

plot_map <- ggplot() +
  geom_sf(data = mapdata,
          aes(fill = ro_count), color = "white") +
  scale_fill_viridis_c(option = "mako", begin = 0.1, end = 0.9, direction = -1,
                       guide = "none") +
  geom_label_repel(data = labeldata, 
                   aes(label = ro_count, geometry = geometry),
                   stat = "sf_coordinates",
                   size = 3) +
  theme_void()
plot_map
```
